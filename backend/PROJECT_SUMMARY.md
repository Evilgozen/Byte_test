# 视频耗时分析系统 - 项目总结

## 项目概述

本项目是一个基于 **Vue + FastAPI** 的视频加载时间分析系统，使用 **OpenCV** 进行视频分帧处理，**PaddleOCR** 进行文字识别匹配，**Matplotlib/Plotly** 进行数据可视化。

## 技术栈

- **后端**: FastAPI + SQLAlchemy + SQLite
- **前端**: Vue.js (待开发)
- **视频处理**: OpenCV
- **文字识别**: PaddleOCR
- **数据可视化**: Matplotlib + Plotly
- **数据库**: SQLite (可扩展到 MySQL/PostgreSQL)

## 项目结构

```
backend/
├── models_simple.py          # 数据库模型定义
├── main_simple.py            # FastAPI 应用主文件
├── init_db_simple.py         # 数据库初始化脚本
├── config.py                 # 配置文件
├── utils.py                  # 工具函数
├── requirements.txt          # 依赖包列表
├── PROJECT_SUMMARY.md        # 项目总结文档
├── video_analysis.db         # SQLite 数据库文件
└── data/                     # 数据存储目录
    ├── videos/               # 视频文件存储
    ├── frames/               # 视频帧图片存储
    ├── charts/               # 可视化图表存储
    ├── temp/                 # 临时文件
    └── backups/              # 备份文件
```

## 数据库设计

### 核心表结构

1. **projects** - 项目表
   - 管理不同的分析项目

2. **videos** - 视频表
   - 存储上传的视频文件信息
   - 包含文件路径、大小、时长、帧率等元数据

3. **stage_configs** - 阶段配置表
   - 定义视频分析的各个阶段
   - 包含关键词、起止规则等配置

4. **video_frames** - 视频帧表
   - 存储提取的视频帧信息
   - 包含帧序号、时间戳、文件路径等

5. **ocr_results** - OCR识别结果表
   - 存储文字识别结果
   - 包含识别文本、置信度、坐标信息等

6. **stage_analysis_results** - 阶段分析结果表
   - 存储各阶段的分析结果
   - 包含开始/结束时间戳、耗时、匹配关键词等

7. **visualization_reports** - 可视化报告表
   - 存储生成的图表信息
   - 支持时间线、耗时图表、对比分析等类型

## 核心功能

### 1. 项目管理
- 创建分析项目
- 查看项目列表
- 项目详情管理

### 2. 视频管理
- 视频文件上传
- 视频元数据提取
- 视频处理状态跟踪

### 3. 阶段配置
- 定义分析阶段
- 配置关键词匹配规则
- 设置起止检测规则

### 4. 视频处理 (待实现)
- OpenCV 视频分帧
- 帧图片存储管理
- 处理进度跟踪

### 5. OCR 识别 (待实现)
- PaddleOCR 文字识别
- 识别结果存储
- 置信度评估

### 6. 阶段分析 (待实现)
- 关键词匹配算法
- 阶段时间计算
- 结果置信度评估

### 7. 数据可视化 (待实现)
- 时间线图表
- 耗时对比图
- 分析报告生成

## API 接口

### 项目管理
- `POST /projects/` - 创建项目
- `GET /projects/` - 获取项目列表
- `GET /projects/{project_id}` - 获取项目详情

### 视频管理
- `POST /videos/upload/{project_id}` - 上传视频
- `GET /videos/{video_id}` - 获取视频详情
- `GET /projects/{project_id}/videos/` - 获取项目视频列表

### 阶段配置
- `POST /stage-configs/` - 创建阶段配置
- `GET /videos/{video_id}/stage-configs/` - 获取视频阶段配置

### 系统信息
- `GET /system/info` - 获取系统状态信息
- `GET /` - 系统根路径

## 配置说明

### 环境配置
- 数据库连接: SQLite (默认)
- 存储路径: `./data/`
- 服务端口: 8000

### OCR 配置
- 语言: 中文 (ch)
- 设备: CPU (可配置 GPU)
- 置信度阈值: 0.7

### 视频处理配置
- 支持格式: mp4, avi, mov, mkv, wmv, flv, webm
- 帧提取频率: 1 FPS
- 最大文件大小: 500MB

## 部署说明

### 1. 环境准备
```bash
# 安装依赖
pip install -r requirements.txt
```

### 2. 数据库初始化
```bash
# 运行初始化脚本
python init_db_simple.py
```

### 3. 启动服务
```bash
# 方式1: 直接运行
python main.py

# 方式2: 使用 uvicorn
uvicorn main:app --reload --host 127.0.0.1 --port 8000
```

### 4. 访问服务
- API 文档: http://localhost:8000/docs
- 系统信息: http://localhost:8000/system/info

## 开发进度

### ✅ 已完成
- [x] 数据库模型设计
- [x] 基础 API 接口
- [x] 项目和视频管理
- [x] 阶段配置管理
- [x] 文件上传功能
- [x] 数据库初始化
- [x] 系统配置管理

### 🚧 进行中
- [ ] 视频分帧处理
- [ ] OCR 文字识别
- [ ] 阶段分析算法
- [ ] 数据可视化

### 📋 待开发
- [ ] 前端 Vue.js 应用
- [ ] 用户认证系统
- [ ] 批量处理功能
- [ ] 性能优化
- [ ] 单元测试
- [ ] 部署文档

## 扩展计划

### 功能扩展
1. **实时处理**: 支持实时视频流分析
2. **多语言支持**: 扩展更多 OCR 语言
3. **AI 增强**: 集成深度学习模型提升识别准确率
4. **云存储**: 支持云端文件存储
5. **API 扩展**: 提供更丰富的分析 API

### 性能优化
1. **异步处理**: 视频处理异步化
2. **缓存机制**: 添加 Redis 缓存
3. **数据库优化**: 索引优化和查询优化
4. **并发处理**: 支持多视频并发分析

### 部署优化
1. **容器化**: Docker 部署支持
2. **微服务**: 拆分为多个微服务
3. **负载均衡**: 支持集群部署
4. **监控告警**: 添加系统监控

## 注意事项

1. **依赖版本**: 注意 SQLModel 和 Pydantic 版本兼容性
2. **文件存储**: 大文件存储需要考虑磁盘空间
3. **性能考虑**: 视频处理是 CPU 密集型操作
4. **安全性**: 文件上传需要安全验证
5. **扩展性**: 数据库设计支持水平扩展

## 联系信息

如有问题或建议，请联系开发团队。

---

**项目状态**: 开发中  
**最后更新**: 2025-06-26  
**版本**: v1.0.0